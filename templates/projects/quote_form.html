{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Create Quote{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Create New Quote</h2>
  <form method="POST" novalidate>
    {% csrf_token %}
    <h4 class="mt-5">Building Measurements</h4>
    <table class="table table-bordered mt-4">
      <thead class="thead-dark">
        <tr>
          <th>Variable</th>
          <th>House</th>
          <th>Garage</th>
        </tr>
      </thead>
      <tbody>
        <!-- Main Variables -->
        <tr>
          <td>Length</td>
          <td>{{ form.oc_ppu }}</td>
          <td>{{ form.cc_ppu }}</td>
          <td>{{ form.hy_ppu }}</td>
        </tr>
       
        <tr>
          <td>Width</td>
          <td>{{ form.oc_ppu }}</td>
          <td>{{ form.cc_ppu }}</td>
          <td>{{ form.hy_ppu }}</td>
        </tr>

      </tbody>
    </table>

    <!-- Interior Walls -->
    <!-- Gables -->
    <!-- Roof Deck -->
    <!-- False Walls -->
    <!-- Windows -->
    <h4 class="mt-5">Windows</h4>
    <table class="table table-bordered mt-4">
      <thead class="thead-dark">
        <tr>
          <th>Variable</th>
          <th>House</th>
          <th>Garage</th>
        </tr>
      </thead>
      <tbody>
        <!-- Main Variables -->
        <tr>
          <td>Length</td>
          <td>{{ form.oc_ppu }}</td>
          <td>{{ form.cc_ppu }}</td>
          <td>{{ form.hy_ppu }}</td>
        </tr>
       
        <tr>
          <td>Width</td>
          <td>{{ form.oc_ppu }}</td>
          <td>{{ form.cc_ppu }}</td>
          <td>{{ form.hy_ppu }}</td>
        </tr>

      </tbody>
    </table>
    <!-- Doors -->
    <h4 class="mt-5">Doors</h4>
    <table class="table table-bordered mt-4">
      <thead class="thead-dark">
        <tr>
          <th>Variable</th>
          <th>House</th>
          <th>Garage</th>
        </tr>
      </thead>
      <tbody>
        <!-- Main Variables -->
        <tr>
          <td>Length</td>
          <td>{{ form.oc_ppu }}</td>
          <td>{{ form.cc_ppu }}</td>
          <td>{{ form.hy_ppu }}</td>
        </tr>
       
        <tr>
          <td>Width</td>
          <td>{{ form.oc_ppu }}</td>
          <td>{{ form.cc_ppu }}</td>
          <td>{{ form.hy_ppu }}</td>
        </tr>

      </tbody>
    </table>
    
    <h4 class="mt-5">Spray Foam Calculations</h4>
    <table class="table table-bordered mt-4">
      <thead class="thead-dark">
        <tr>
          <th>Variable</th>
          <th>Open Cell</th>
          <th>Closed Cell</th>
          <th>Hybrid</th>
        </tr>
      </thead>
      <tbody>
        <!-- Main Variables -->
        <tr>
          <td>Price Per Unit</td>
          <td>{{ form.oc_ppu }}</td>
          <td>{{ form.cc_ppu }}</td>
          <td>{{ form.hy_ppu }}</td>
        </tr>
        <tr>
          <td>Wall Thickness</td>
          <td>{{ form.oc_wall_thickness }}</td>
          <td>{{ form.cc_wall_thickness }}</td>
          <td>{{ form.hy_wall_thickness }}</td>
        </tr>
        <tr>
          <td>House Roof Deck Thickness</td>
          <td>{{ form.oc_roof_deck_thickness }}</td>
          <td>{{ form.cc_roof_deck_thickness }}</td>
          <td>{{ form.hy_roof_deck_thickness }}</td>
        </tr>
        <tr>
          <td>Sets</td>
          <td>{{ form.oc_sets }}</td>
          <td>{{ form.cc_sets }}</td>
          <td>{{ form.hy_sets }}</td>
        </tr>
        <tr>
          <td>Roof Deck Volume</td>
          <td>{{ form.oc_house_roof_deck_vol }}</td>
          <td>{{ form.cc_house_roof_deck_vol }}</td>
          <td>{{ form.hy_house_roof_deck_vol }}</td>
        </tr>
        <tr>
          <td>Ext House Walls (Sq Ft)</td>
          <td>{{ form.oc_ext_house_wall_sqft }}</td>
          <td>{{ form.cc_ext_house_wall_sqft }}</td>
          <td>{{ form.hy_ext_house_wall_sqft }}</td>
        </tr>
        <tr>
          <td>Total Sprayable Board Feet</td>
          <td><input type="text" id="open_board_feet" class="form-control" readonly /></td>
          <td><input type="text" id="closed_board_feet" class="form-control" readonly /></td>
          <td><input type="text" id="hybrid_board_feet" class="form-control" readonly /></td>
        </tr>
        <tr>
          <td>Total Cost</td>
          <td><input type="text" id="open_total_cost" name="oc_total_cost" class="form-control" readonly /></td>
          <td><input type="text" id="closed_total_cost" name="cc_total_cost" class="form-control" readonly /></td>
          <td><input type="text" id="hybrid_total_cost" name="hy_total_cost" class="form-control" readonly /></td>
        </tr>
        <tr>
          <td>Profit</td>
          <td>{{ form.oc_profit }}</td>
          <td>{{ form.cc_profit }}</td>
          <td>{{ form.hy_profit }}</td>
        </tr>

        <!-- Dynamic rows from context -->
        {% for label, oc, cc, hy in additional_rows %}
        <tr>
          <td>{{ label }}</td>
          <td>{{ form|get_item:oc }}</td>
          <td>{{ form|get_item:cc }}</td>
          <td>{{ form|get_item:hy }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Additional Services Section -->
    <h4 class="mt-5">Additional Service Options</h4>
    <div class="row mt-3">
      <div class="col-md-4">
        <h5>Fiberglass</h5>
        <div class="form-group"><label>Labor/sqft</label>{{ form.fg_labor_sqft }}</div>
        <div class="form-group"><label>Cost/sqft</label>{{ form.fg_cost_sqft }}</div>
        <div class="form-group"><label>Profit/sqft</label>{{ form.fg_profit_sqft }}</div>
      </div>
      <div class="col-md-4">
        <h5>Cathedral</h5>
        <div class="form-group"><label>Labor/sqft</label>{{ form.cd_labor_sqft }}</div>
        <div class="form-group"><label>Cost/sqft</label>{{ form.cd_cost_sqft }}</div>
        <div class="form-group"><label>Profit/sqft</label>{{ form.cd_profit_sqft }}</div>
      </div>
      <div class="col-md-4">
        <h5>Blow-In</h5>
        <div class="form-group"><label>Labor/sqft</label>{{ form.bi_labor_sqft }}</div>
        <div class="form-group"><label>Cost/sqft</label>{{ form.bi_cost_sqft }}</div>
        <div class="form-group"><label>Profit/sqft</label>{{ form.bi_profit_sqft }}</div>
      </div>
    </div>

    <!-- Attic Add-On -->
    <h5 class="mt-5">Attic Add-On</h5>
    <div class="row">
      <div class="col-md-6"><div class="form-group">{{ form.cc_attic_floor_sqft.label_tag }}{{ form.cc_attic_floor_sqft }}</div></div>
      <div class="col-md-6"><div class="form-group">{{ form.cc_attic_inches_thick.label_tag }}{{ form.cc_attic_inches_thick }}</div></div>
    </div>

    <!-- Submit Button -->
    <button type="submit" class="btn btn-success mt-4">Save Quote</button>
  </form>
</div>

<!-- Profitability Metrics Table -->
<h4>Profitability Metrics</h4>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Variable</th>
      <th>Open Cell</th>
      <th>Closed Cell</th>
      <th>Hybrid</th>
    </tr>
  </thead>
  <tbody>
    {{ readonly_metrics|safe }}
  </tbody>
</table>

<!-- CostSettings hidden fields for JS -->
<!--<input type="hidden" id="open_material_cost" data-default="{{ cost_settings.open_cell_material_cost }}">
<input type="hidden" id="open_labor_rate" data-default="{{ cost_settings.open_cell_labor_rate }}">
<input type="hidden" id="open_coverage" data-default="{{ cost_settings.open_cell_coverage }}">
<input type="hidden" id="closed_material_cost" data-default="{{ cost_settings.closed_cell_material_cost }}">
<input type="hidden" id="closed_labor_rate" data-default="{{ cost_settings.closed_cell_labor_rate }}">
<input type="hidden" id="closed_coverage" data-default="{{ cost_settings.closed_cell_coverage }}">
<input type="hidden" id="hybrid_material_cost" data-default="{{ cost_settings.hybrid_material_cost }}">
<input type="hidden" id="hybrid_labor_rate" data-default="{{ cost_settings.hybrid_labor_rate }}">
<input type="hidden" id="hybrid_coverage" data-default="{{ cost_settings.hybrid_coverage }}">
-->
<script src="{% static 'js/quote_calc.js' %}"></script>
{% endblock %}
